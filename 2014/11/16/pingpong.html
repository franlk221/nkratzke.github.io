<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-site-verification" content="D7XyV9pkZo4Wsv7981mVGuGEiSF7WG0Id_J1jGMarcU" />
    <meta property="twitter:account_id" content="4503599630726265" />
    <title>Ping Pong</title>

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/customize.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">

    

    <link href='/feed.xml' rel='alternate' type='application/atom+xml'>
    <!-- Google Analytics -->
    <script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-380838-9']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; 

ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';

var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
  </head>
  <body>

    <!-- Fixed navbar -->
<div class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
    	<span class="sr-only">Toggle navigation</span>
    	<span class="icon-bar"></span>
    	<span class="icon-bar"></span>
    	<span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><div class="brand-icon"></div>nkode.io</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav pull-right">
  	    <li id="about"><a href="/about.html">About me</a></li>
        <li id="blog"><a href="/blog.html">Blog</a></li>
        <li id="research"><a href="/research.html">Research</a></li>
        <li id="lectures"><a href="/lectures.html">Lectures</a></li>
        <li id="thesis"><a href="/thesis.html">Thesis</a></li>
        <li id="archive"><a href="/log.html">Log</a></li>
  		  <li id="publications"><a href="/publications.html">Publications</a></li>
    	</ul>
    </div>
  </div>
</div>


    
    <div class="content">
      <div class="container">
        <article class="post ">
	<header>
		
		<div class='imgteaser' style='background:transparent url("/img/posts/pingpong-experiment.png") no-repeat center center;background-size:cover'>
		</div>
		
		<div class="headline">
			
			<h2>Ping Pong</h2>
			<p class="meta">
			
			<strong>16 Nov 2014</strong>
			
			</p>
		</div>
	</header>
	<section>
		<div class="rightbar">
			<h3>Tags </h3>
			<div class="tags hidden-print">
	<ul>
	
		<li><a href="/tag/blog"><span class="tag">#blog</span></a></li>
	
		<li><a href="/tag/docker"><span class="tag">#docker</span></a></li>
	
		<li><a href="/tag/dart"><span class="tag">#dart</span></a></li>
	
		<li><a href="/tag/network"><span class="tag">#network</span></a></li>
	
		<li><a href="/tag/cloud"><span class="tag">#cloud</span></a></li>
	
		<li><a href="/tag/container"><span class="tag">#container</span></a></li>
	
	</ul>
</div>

			<h3>Share </h3>
			<div class="share hidden-print">
	<ul>
		<li>
			<a href="http://twitter.com/home?status=Ping+Pong http://www.nkode.io/2014/11/16/pingpong.html" target="_blank">
				<img src="/img/social/twitter-128-black.png">
			</a>
		</li>
		<li>
			<a href="https://plus.google.com/share?url=http://www.nkode.io/2014/11/16/pingpong.html" target="_blank">
				<img src="/img/social/googleplus-128-black.png">
			</a>
		</li>
		<li>
			<a href="http://www.linkedin.com/shareArticle?mini=true&url=http://www.nkode.io/2014/11/16/pingpong.html&title=Ping+Pong&summary=&source=" target="_blank">
				<img src="/img/social/linkedin-128-black.png">
			</a>
		</li>
		<li>
			<a href="https://www.xing.com/app/user?op=share&url=http%3A%2F%2Fwww.nkode.io%2F2014%2F11%2F16%2Fpingpong.html&title=Ping+Pong" target="_blank">
				<img src="/img/social/xing-128-black.png">
			</a>
		</li>
	</ul>
</div>

		</div>
		<h3>A distributed HTTP-based and REST-like ping-pong system for test and benchmarking purposes.</h3>

<p>The intended usage of this <a href="https://github.com/nkratzke/pingpong">tool suite</a> (check it out on <a href="https://github.com/nkratzke/pingpong">github</a>) is to run two hosts which are queried (benchmarked) by a third host (the <em>siege</em>). Host 1 runs a <em>ping</em> service querying a <em>pong</em> service (on host 2) for the answer. <em>Ping</em> and <em>pong</em> build a very simple distributed system.</p>

<p><img src="/img/posts/pingpong-experiment.png" width=90%></p>

<p>From a benchmark host (this is called the <em>siege</em> host) a benchmark (e.g. apachebench) is run againt host 1. <em>Ping</em> host 1 has to interact with <em>pong</em> host 2 to answer the request. The interaction between both hosts is very simple. Whenever host 1 (<em>ping</em>) is asked to deliver a document for &#39;/ping/<nr>&#39; this request is passed forward to host 2 (<em>pong</em>). Host 2 (<em>pong</em>) returns the answer which is formed of a message &quot;pooooong&quot; where the message is as long in bytes as the number &#39;<nr>&#39; provided with the query (so the answer message length can be specified by the <em>siege</em> host to benchmark network performance of message sizes of varying length).</p>

<p>So the following answers would be generated for following requests by host 2:</p>

<ul>
<li>GET /pong/4 returns &quot;pong&quot;</li>
<li>GET /pong/5 returns &quot;poong&quot;</li>
<li>GET /pong/6 returns &quot;pooong&quot;</li>
<li>and so on</li>
</ul>

<p>So we can vary the message size (and therefore the network load) between <em>ping</em> (host 1) and <em>pong</em> (host 2).</p>

<p>This setting shall be used to analyse the impact of infrastructures where <em>ping</em> and <em>pong</em> services are running on. The deployment above stays the same for every experiment. Just the underlying infrastructure of <em>ping</em> and <em>pong</em> changes. Therefore variations of benchmark results can be assigned to changing infrastructures.</p>

<h3>Set up a benchmark experiment</h3>

<p>To do a benchmark you have to set up a <em>siege</em>, a <em>ping</em> and a <em>pong</em> host. We assume these are Linux hosts with git, apt-get, wget and curl installed. Install this package on all of this three hosts by running following commands.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git clone https://github.com/nkratzke/pingpong.git
cd pingpong
sudo sh ./install.sh
</code></pre></div>
<p>This will install dart runtime and development environment, apachebench, docker as well as the docker overlay network weave.</p>

<p>It is possible to run the <em>ping</em> and <em>pong</em> service as a docker container. Therefore you have to build a pingpong image on your <em>ping</em> and <em>pong</em> hosts, like that:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">docker build -t pingpong github.com/nkratzke/pingpong
</code></pre></div>
<p>Please be aware, that the dockerized ping-pong system will not show the same performance like a &quot;naked&quot; run ping-pong system.</p>

<h3>On the pong host: Set up the <em>pong service</em></h3>

<p>First step is to start the <em>pong</em> service on the <em>pong</em> host. This will start the <em>pong</em> service on the host on port 8080.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">pong:$ sudo dart bin/pong.dart --port=8080
</code></pre></div>
<p>It is although possible to run the pong server as docker container (you will have performance impacts of about 10% to 20%):</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">pong:$ docker build -t pingpong github.com/nkratzke/pingpong
pong:$ docker run -d -p 8080:8080 pingpong --asPong --port=8080
</code></pre></div>
<p>You want to check wether the <em>pong</em> service is working correctly by checking that</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">pong:$ curl http://localhost:8080/pong/5
</code></pre></div>
<p>answers with &#39;poong&#39;.</p>

<p>Please figure out the IP adress or DNS name the your pong host. We will refer to it as <code>&lt;pongip&gt;</code>.</p>

<h3>On the ping host: Set up the <em>ping service</em></h3>

<p>Second step is to start the <em>ping</em> service on the <em>ping</em> host. This will start the <em>ping</em> service on the host on port 8080.
You will have to provide the <em>ping</em> service where it will find its <em>pong</em> service by providing <code>&lt;pongip&gt;</code> and port number you have assigned to the <em>pong</em> service above.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ping:$ sudo dart bin/ping.dart --port=8080 --url=http://&lt;pongip&gt;:8080
</code></pre></div>
<p>It is although possible to run the ping server as docker container (you will have performance impacts of about 10% to 20%):</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">pong:$ docker build -t pingpong github.com/nkratzke/pingpong
pong:$ docker run -d -p 8080:8080 pingpong --asPing --port=8080 --url=http://&lt;pongip&gt;:8080
</code></pre></div>
<p>You want to check wether the <em>ping</em> service is started and able to communicate with the <em>pong</em> service by checking that</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ping:$ curl http://localhost:8080/ping/5
</code></pre></div>
<p>answers with &#39;poong&#39;.</p>

<p>Please figure out the IP adress or DNS name the your ping host. We will refer to it as <code>&lt;pingip&gt;</code>.</p>

<h3>On the siege host: set up apachebench</h3>

<p>Third step you should run the benchmark to figure out the answer performance of your ping-pong system. On your <em>siege</em> host you will find a <code>run.sh</code> script to start your benchmark. You should replace <code>http://my.host.com/ping</code> with <code>http://&lt;pingip&gt;:8080/ping</code> to provide the script the correct ping service uri.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Run the experiment against
# You have to specify your ping host here!
URL=http://my.host.com/ping
</code></pre></div>
<p>The <code>run.sh</code> script provides more parameters to vary your experiments. You can change</p>

<ul>
<li>the amount of concurrent messages,</li>
<li>the message sizes,</li>
<li>and how often each benchmark run per message size should be executed.</li>
</ul>

<p>All benchmark results are written into a file <code>apachebench.log</code>. This log file can be processed by <code>bin/analyze.dart</code> to generate a csv file which is better suited to be imported into databases or statistical tools like R.</p>

<p>The following line converts experiment data (apachebench log format), tag it with a name (here &#39;Reference&#39;) and convert it into a csv file. You can use tags to distinguish different experiments for analysis.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">dart bin/analze.dart --tag=Reference apachebench.log &gt; reference.csv
</code></pre></div>
		
			<hr>
			<div id="disqus_thread"></div>
			<script type="text/javascript">
					/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
					var disqus_shortname = 'wwwnkodeio'; // required: replace example with your forum shortname

					/* * * DON'T EDIT BELOW THIS LINE * * */
					(function() {
							var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
							dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
							(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
					})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		
	</section>
	<footer>
	</footer>
	
</article>

      </div>
    </div>

    <div class="end hidden-print">
  <div class="container">
     <div class="row">
    	<div class="col-sm-5 block">
	        <center>
		    	&copy; Nane Kratzke (All rights reserved)
		   		<div class="socialsites">
  <center>
   <a href="https://twitter.com/nanekratzke" title="Twitter"><img src="/img/social/twitter-128.png" alt="Twitter"></a>
   <a href="http://www.slideshare.com/i21aneka" title="Slideshare"><img src="/img/social/slideshare-128.png" alt="Slideshare"></a>
   <a href="https://github.com/nkratzke" title="Github"><img src="/img/social/github-128.png" alt="Github"></a>
   <a href="https://www.researchgate.net/profile/Nane_Kratzke" title="Researchgate"><img src="/img/social/researchgate-128.png" alt="Researchgate"></a>
   <a href="https://de.linkedin.com/in/nanekratzke" title="LinkedIN"><img src="/img/social/linkedin-128.png" alt="LinkedIN"></a>
   <a href="https://www.xing.com/profile/Nane_Kratzke" title="Xing"><img src="/img/social/xing-128.png" alt="Xing"></a>
   <a href="https://plus.google.com/+NaneKratzke" title="Google Plus"><img src="/img/social/googleplus-128.png" alt="Google Plus"></a>
   <a href="https://www.facebook.com/nane.kratzke" title="Facebook"><img src="/img/social/facebook-128.png" alt="Facebook"></a>
   <a href="/feed.xml" title="RSS"><img src="/img/social/rss-128.png" alt="RSS"></a>
 </center>
</div>

    		</center>
    	</div>
        <div class="col-sm-2"></div>
    	<div class="col-sm-5 block hidden-xs">
	    	<center>
		      Links to my official sites
		      <div class="officialsites">
   <a href="https://www.fh-luebeck.de/hochschule/hochschulorganisation/personalverzeichnis/person/nane-kratzke/"><img src="/img/official/fhl-logo.png"></a>
   <a href="http://www.cosa.fh-luebeck.de/en/home/kratzke"><img src="/img/official/cosa-logo.png"></a>
</div>
    		</center>
    	</div>
    </div>
  </div>
</div>

<div class="footer hidden-print">
	<div class="container">
		<center>
			<a href="/about.html">About</a> &bullet;
			<a href="/disclosure.html">Contact</a> &bullet;
			<a href="/disclosure.html">Legal Notice (Impressum)</a>
		</center>
	</div>
</div>


    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  </body>
</html>
