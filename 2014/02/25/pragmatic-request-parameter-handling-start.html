<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-site-verification" content="D7XyV9pkZo4Wsv7981mVGuGEiSF7WG0Id_J1jGMarcU" />
    <title>Pragmatic post parameter handling in start</title>

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/customize.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">

    

    <!-- ShareThis Scripts
    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">stLight.options({publisher: "ur-be54e553-bdea-6613-5866-3a0cca99f467", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>-->

    <!-- Google Analytics -->
    <script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-380838-9']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; 

ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';

var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
  </head>
  <body>

    <!-- Fixed navbar -->
<div class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
    	<span class="sr-only">Toggle navigation</span>
    	<span class="icon-bar"></span>
    	<span class="icon-bar"></span>
    	<span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><div class="brand-icon"></div>nkode.io</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav pull-right">
  	    <li id="about"><a href="/about.html">About me</a></li>
        <li id="blog"><a href="/blog.html">Blog</a></li>
        <li id="research"><a href="/research.html">Research</a></li>
        <li id="lectures"><a href="/lectures.html">Lectures</a></li>
        <li id="thesis"><a href="/thesis/ongoing.html">Thesis</a></li>
        <li id="archive"><a href="/archive.html">Archive</a></li>
  		  <li id="publications"><a href="/publications.html">Publications</a></li>
    	</ul>
    </div>
  </div>
</div>


    
    <div class="content">
      <div class="container">
        <article class="post ">
	<header>
		
		<img src="/img/posts/standard.png" class="photo" width="100%">
		
		<div class="headline">
			<h2>Pragmatic post parameter handling in start</h2>
			<p class="meta"><strong>25 Feb 2014</strong>
			</p>
		</div>
	</header>
	<section>
		<div class="rightbar">
			<h3>Tags </h3>
			<div class="tags hidden-print">
	<ul>
	
		<li><a href="/tag/dart"><span class="tag">#dart</span></a></li>
	
		<li><a href="/tag/programming"><span class="tag">#programming</span></a></li>
	
		<li><a href="/tag/start"><span class="tag">#start</span></a></li>
	
	</ul>
</div>

			<h3>Share </h3>
			<div class="share hidden-print">
	<ul>
		<li>
			<a href="http://twitter.com/home?status=Pragmatic+post+parameter+handling+in+start http://www.nkode.io/2014/02/25/pragmatic-request-parameter-handling-start.html" target="_blank">
				<img src="/img/social/twitter-128-black.png">
			</a>
		</li>
		<li>
			<a href="https://plus.google.com/share?url=http://www.nkode.io/2014/02/25/pragmatic-request-parameter-handling-start.html" target="_blank">
				<img src="/img/social/googleplus-128-black.png">
			</a>
		</li>
		<li>
			<a href="http://www.linkedin.com/shareArticle?mini=true&url=http://www.nkode.io/2014/02/25/pragmatic-request-parameter-handling-start.html&title=Pragmatic+post+parameter+handling+in+start&summary=&source=" target="_blank">
				<img src="/img/social/linkedin-128-black.png">
			</a>
		</li>
		<li>
			<a href="https://www.xing.com/app/user?op=share&url=http%3A%2F%2Fwww.nkode.io%2F2014%2F02%2F25%2Fpragmatic-request-parameter-handling-start.html&title=Pragmatic+post+parameter+handling+in+start" target="_blank">
				<img src="/img/social/xing-128-black.png">
			</a>
		</li>
	</ul>
</div>

		</div>
		<p><a href="https://github.com/lvivski/start">Start</a> is a <a href="http://www.sinatrarb.com/">Sinatra</a> inspired web framework for <a href="https://www.dartlang.org/">Dart</a>. Up to version 0.2.0 <a href="https://github.com/lvivski/start">Start</a> provided no pragmatic post parameter handling. With <a href="https://github.com/lvivski/start/issues/49">issue 49</a> I proposed a <code>getPostParams</code> method for the <code>Request</code> class.</p>

<p>That is how my <a href="https://github.com/lvivski/start/issues/49">proposal</a> looked like:</p>

<div class="highlight"><pre><code class="dart"><span class="cm">/**</span>
<span class="cm"> * Method to get post parameters from a [Request] object.</span>
<span class="cm"> */</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;&gt;</span> <span class="n">getPostParams</span><span class="p">({</span> <span class="n">Encoding</span> <span class="nl">enc:</span> <span class="n">UTF8</span> <span class="p">})</span> <span class="p">{</span>
  <span class="n">Completer</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Completer</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="n">input</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="kd">const</span> <span class="n">AsciiDecoder</span><span class="p">()).</span><span class="n">listen</span><span class="p">((</span><span class="n">content</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">postParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Map</span><span class="p">.</span><span class="n">fromIterable</span><span class="p">(</span>
        <span class="n">content</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">).</span><span class="n">map</span><span class="p">((</span><span class="n">kvs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">kvs</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)),</span>
        <span class="nl">key:</span> <span class="p">(</span><span class="n">kv</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Uri</span><span class="p">.</span><span class="n">decodeQueryComponent</span><span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="nl">encoding:</span> <span class="n">enc</span><span class="p">),</span>
        <span class="nl">value:</span> <span class="p">(</span><span class="n">kv</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Uri</span><span class="p">.</span><span class="n">decodeQueryComponent</span><span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="nl">encoding:</span> <span class="n">enc</span><span class="p">)</span>
    <span class="p">);</span>
    <span class="n">c</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="n">postParams</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">future</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>This proposal has made it to <a href="https://github.com/lvivski/start">Start</a> version 0.2.1 with following <a href="https://github.com/lvivski/start/commit/8b68217ae8b3674429e883fc64f1a66b6f8dfcc8">commit</a>. So with <a href="https://github.com/lvivski/start">Start</a> version 0.2.1 you can do now the following pragmatic form of post request parameter handling.</p>

<div class="highlight"><pre><code class="dart"><span class="k">import</span> <span class="s1">&#39;package:start/start.dart&#39;</span><span class="p">;</span>

<span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">start</span><span class="p">(</span><span class="nl">port:</span> <span class="m">3000</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">Server</span> <span class="n">app</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="p">[...]</span>
    
    <span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/formular&quot;</span><span class="p">).</span><span class="n">listen</span><span class="p">((</span><span class="n">Request</span> <span class="n">req</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">req</span><span class="p">.</span><span class="n">postParams</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="n">params</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">final</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;first name&#39;</span><span class="p">];</span>
        <span class="kd">final</span> <span class="n">ln</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;last name&#39;</span><span class="p">];</span>
        <span class="n">req</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Hello </span><span class="si">$</span><span class="n">fn</span><span class="s2"> </span><span class="si">$</span><span class="n">ln</span><span class="s2">&quot;</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>

    <span class="p">[...]</span>

  <span class="p">});</span>
<span class="p">}</span></code></pre></div>

<p>Thanks to <a href="https://github.com/lvivski">Yehor Lvivski</a> for providing the <a href="http://www.sinatrarb.com/">Sinatra</a> inspired <a href="https://github.com/lvivski/start">Start</a> web framework and for integrating <a href="https://github.com/lvivski/start/issues/49">issue 49</a>. It makes post parameter handling with <a href="https://github.com/lvivski/start">Start</a> more pragmatic.</p>

<h3>Update</h3>

<p>Since <a href="https://github.com/lvivski/start">Start</a> version 0.2.2 you should use <code>payload()</code>. By using <code>payload</code> you can also handle parameters provided via POST, PUT, DELETE in request body. Above mentioned parameter handling changes to:</p>

<div class="highlight"><pre><code class="dart"><span class="k">import</span> <span class="s1">&#39;package:start/start.dart&#39;</span><span class="p">;</span>

<span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">start</span><span class="p">(</span><span class="nl">port:</span> <span class="m">3000</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">Server</span> <span class="n">app</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">[...]</span>

    <span class="c1">// Since version 0.2.2 ALSO put and delete is possible here</span>
    <span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/formular&quot;</span><span class="p">).</span><span class="n">listen</span><span class="p">((</span><span class="n">Request</span> <span class="n">req</span><span class="p">)</span> <span class="p">{</span>  
      <span class="n">req</span><span class="p">.</span><span class="n">payload</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="n">params</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">final</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;first name&#39;</span><span class="p">];</span>
        <span class="kd">final</span> <span class="n">ln</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;last name&#39;</span><span class="p">];</span>
        <span class="n">req</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Hello </span><span class="si">$</span><span class="n">fn</span><span class="s2"> </span><span class="si">$</span><span class="n">ln</span><span class="s2">&quot;</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>

    <span class="p">[...]</span>

  <span class="p">});</span>
<span class="p">}</span></code></pre></div>

	</section>
	<footer>
	</footer>
	
</article>

      </div>
    </div>

    <div class="end hidden-print">
  <div class="container">
      <div class="row">
    	<div class="col-sm-5 block">
	    	<center>
		    	&copy; Nane Kratzke (All rights reserved)
		   		<div class="socialsites">
   <a href="https://twitter.com/nanekratzke" title="Twitter"><img src="/img/social/twitter-128.png" alt="Twitter"></a>
   <a href="http://www.slideshare.com/i21aneka" title="Slideshare"><img src="/img/social/slideshare-128.png" alt="Slideshare"></a>
   <a href="https://github.com/nkratzke" title="Github"><img src="/img/social/github-128.png" alt="Github"></a>
   <a href="https://de.linkedin.com/in/nanekratzke" title="LinkedIN"><img src="/img/social/linkedin-128.png" alt="LinkedIN"></a>
   <a href="https://www.xing.com/profile/Nane_Kratzke" title="Xing"><img src="/img/social/xing-128.png" alt="Xing"></a>
   <a href="https://plus.google.com/+NaneKratzke" title="Google Plus"><img src="/img/social/googleplus-128.png" alt="Google Plus"></a>
   <a href="https://www.facebook.com/nane.kratzke" title="Facebook"><img src="/img/social/facebook-128.png" alt="Facebook"></a>
   <a href="/rss.xml" title="RSS"><img src="/img/social/rss-128.png" alt="RSS"></a>

</div>
    		</center>
    	</div>
       <div class="col-sm-2"></div>
    	<div class="col-sm-5 block hidden-xs">
	    	<center>
		      Links to my official sites
		      <div class="officialsites">
   <a href="http://www.fh-luebeck.de/Inhalt/09_Fachhochschule_intern/07_Services/70_Verzeichnis_der_Hochschulangehoerigen/06_personenarchiv/kratzke_nane.html"><img src="/img/official/fhl-logo.png"></a>
   <a href="http://www.cosa.fh-luebeck.de/en/home/kratzke"><img src="/img/official/cosa-logo.png"></a>
</div>
    		</center>
    	</div>
      </div>
    </div>
  </div>
</div>

<div class="footer hidden-print">
	<div class="container">
		<center>
			<a href="/about.html">About</a> &bullet;
			<a href="/disclosure.html">Contact</a> &bullet;
			<a href="/disclosure.html">Legal Notice (Impressum)</a>
		</center>
	</div>
</div>


    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  </body>
</html>
